{
   "Version":"2019-10-30",
   "StartAction":"c1e32bb1-0b0a-47df-8548-a0d11ff8d67f",
   "Metadata":{
      "entryPointPosition":{
         "x":-384,
         "y":172
      },
      "ActionMetadata":{
         "c1e32bb1-0b0a-47df-8548-a0d11ff8d67f":{
            "position":{
               "x":-308.8,
               "y":169.6
            }
         },
         "f1fff6cc-0dde-4ac9-824f-60e954567ce8":{
            "position":{
               "x":836.8,
               "y":276.8
            }
         },
         "60ad299f-5ce6-4205-a58e-070eeff7199b":{
            "position":{
               "x":1064.8,
               "y":608
            }
         },
         "c220356a-b545-493a-a68b-3f4dabfe8a2c":{
            "position":{
               "x":566.4,
               "y":331.2
            }
         },
         "58876a6d-9a80-43d6-b643-57a161cce8f9":{
            "position":{
               "x":3254.4,
               "y":471.2
            }
         },
         "6cd68362-3e78-4e12-87dc-c05158e44ad3":{
            "position":{
               "x":666.4,
               "y":71.2
            },
            "conditions":[
               
            ],
            "conditionMetadata":[
               {
                  "id":"970b529b-8c8e-4b0c-80fc-17fe48ff21d9",
                  "operator":{
                     "name":"Equals",
                     "value":"Equals",
                     "shortDisplay":"="
                  },
                  "value":"true"
               }
            ]
         },
         "b218efd8-de8b-4cdb-939a-3c9de12b5379":{
            "position":{
               "x":1345.6,
               "y":597.6
            }
         },
         "3019e2ec-d8e8-438d-a68d-29a5a4ee4b16":{
            "position":{
               "x":-52,
               "y":166.4
            },
            "children":[
               "8ccbf853-2838-4774-b886-09508124193e"
            ],
            "overrideConsoleVoice":false,
            "fragments":{
               "SetContactData":"8ccbf853-2838-4774-b886-09508124193e"
            },
            "overrideLanguageAttribute":true
         },
         "8ccbf853-2838-4774-b886-09508124193e":{
            "position":{
               "x":-52,
               "y":166.4
            },
            "dynamicParams":[
               
            ]
         },
         "02178d85-49c5-43d8-9b06-d048973c18e7":{
            "position":{
               "x":379.2,
               "y":81.6
            },
            "parameters":{
               "LambdaFunctionARN":{
                  "displayName":"connect-authentication"
               }
            },
            "dynamicMetadata":{
               
            }
         },
         "5e50ac83-e657-48b8-a46c-2d8ac2710d70":{
            "position":{
               "x":159.2,
               "y":74.4
            },
            "parameters":{
               "LambdaFunctionARN":{
                  "displayName":"gpt-lambda"
               },
               "LambdaInvocationAttributes":{
                  "isWarmUpRequest":{
                     "useJson":true
                  }
               }
            },
            "dynamicMetadata":{
               "isWarmUpRequest":false
            }
         },
         "d7fe82c2-db96-4e78-b4d6-c305c750579c":{
            "position":{
               "x":2004.8,
               "y":427.2
            }
         },
         "Greeting message":{
            "position":{
               "x":1072,
               "y":40
            },
            "isFriendlyName":true
         },
         "abf2c4cd-c921-4300-b185-63ec400fb8f5":{
            "position":{
               "x":1655.2,
               "y":351.2
            }
         },
         "Thanks":{
            "position":{
               "x":1688.8,
               "y":20
            },
            "isFriendlyName":true
         },
         "Lex input":{
            "position":{
               "x":1424,
               "y":36.8
            },
            "isFriendlyName":true,
            "parameters":{
               "LexV2Bot":{
                  "AliasArn":{
                     "displayName":"${lex_bot_alias_name}",
                     "useLexBotDropdown":true,
                     "lexV2BotName":"${lex_bot_name}"
                  }
               },
               "LexSessionAttributes":{
                  "contactId":{
                     "useDynamic":true
                  }
               }
            },
            "dynamicMetadata":{
               "x-amz-lex:audio:max-length-ms:*:*":false,
               "contactId":true,
               "x-amz-lex:audio:end-timeout-ms:*:*":false
            },
            "useLexBotDropdown":true,
            "lexV2BotName":"${lex_bot_name}",
            "lexV2BotAliasName":"${lex_bot_alias_name}",
            "conditionMetadata":[
               {
                  "id":"78447ae8-c3ed-445c-921b-71b060ba1043",
                  "operator":{
                     "name":"Equals",
                     "value":"Equals",
                     "shortDisplay":"="
                  },
                  "value":"FallbackIntent"
               },
               {
                  "id":"2a61750b-5e90-4419-a3c1-9826ce2f8479",
                  "operator":{
                     "name":"Equals",
                     "value":"Equals",
                     "shortDisplay":"="
                  },
                  "value":"GPTIntent"
               }
            ]
         }
      },
      "Annotations":[
         
      ],
      "name":"GPT Flow",
      "description":"Contact flow that will be used for GPT conversation",
      "type":"contactFlow",
      "status":"published",
      "hash":{
         
      }
   },
   "Actions":[
      {
         "Parameters":{
            "FlowLoggingBehavior":"Enabled"
         },
         "Identifier":"c1e32bb1-0b0a-47df-8548-a0d11ff8d67f",
         "Type":"UpdateFlowLoggingBehavior",
         "Transitions":{
            "NextAction":"3019e2ec-d8e8-438d-a68d-29a5a4ee4b16"
         }
      },
      {
         "Parameters":{
            "Text":"Not authorised to use this service"
         },
         "Identifier":"f1fff6cc-0dde-4ac9-824f-60e954567ce8",
         "Type":"MessageParticipant",
         "Transitions":{
            "NextAction":"60ad299f-5ce6-4205-a58e-070eeff7199b",
            "Errors":[
               {
                  "NextAction":"60ad299f-5ce6-4205-a58e-070eeff7199b",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            
         },
         "Identifier":"60ad299f-5ce6-4205-a58e-070eeff7199b",
         "Type":"DisconnectParticipant",
         "Transitions":{
            
         }
      },
      {
         "Parameters":{
            "Text":"Error invoking authentication lambda"
         },
         "Identifier":"c220356a-b545-493a-a68b-3f4dabfe8a2c",
         "Type":"MessageParticipant",
         "Transitions":{
            "NextAction":"60ad299f-5ce6-4205-a58e-070eeff7199b",
            "Errors":[
               {
                  "NextAction":"60ad299f-5ce6-4205-a58e-070eeff7199b",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            
         },
         "Identifier":"58876a6d-9a80-43d6-b643-57a161cce8f9",
         "Type":"DisconnectParticipant",
         "Transitions":{
            
         }
      },
      {
         "Parameters":{
            "ComparisonValue":"$.External.callerAllowed"
         },
         "Identifier":"6cd68362-3e78-4e12-87dc-c05158e44ad3",
         "Type":"Compare",
         "Transitions":{
            "NextAction":"f1fff6cc-0dde-4ac9-824f-60e954567ce8",
            "Conditions":[
               {
                  "NextAction":"Greeting message",
                  "Condition":{
                     "Operator":"Equals",
                     "Operands":[
                        "true"
                     ]
                  }
               }
            ],
            "Errors":[
               {
                  "NextAction":"f1fff6cc-0dde-4ac9-824f-60e954567ce8",
                  "ErrorType":"NoMatchingCondition"
               }
            ]
         }
      },
      {
         "Parameters":{
            
         },
         "Identifier":"b218efd8-de8b-4cdb-939a-3c9de12b5379",
         "Type":"DisconnectParticipant",
         "Transitions":{
            
         }
      },
      {
         "Parameters":{
            "TextToSpeechVoice":"Emma"
         },
         "Identifier":"3019e2ec-d8e8-438d-a68d-29a5a4ee4b16",
         "Type":"UpdateContactTextToSpeechVoice",
         "Transitions":{
            "NextAction":"8ccbf853-2838-4774-b886-09508124193e"
         }
      },
      {
         "Parameters":{
            "LanguageCode":"en-GB"
         },
         "Identifier":"8ccbf853-2838-4774-b886-09508124193e",
         "Type":"UpdateContactData",
         "Transitions":{
            "NextAction":"5e50ac83-e657-48b8-a46c-2d8ac2710d70",
            "Errors":[
               {
                  "NextAction":"5e50ac83-e657-48b8-a46c-2d8ac2710d70",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            "LambdaFunctionARN":"${connect_authentication_lambda_arn}",
            "InvocationTimeLimitSeconds":"3",
            "ResponseValidation":{
               "ResponseType":"STRING_MAP"
            }
         },
         "Identifier":"02178d85-49c5-43d8-9b06-d048973c18e7",
         "Type":"InvokeLambdaFunction",
         "Transitions":{
            "NextAction":"6cd68362-3e78-4e12-87dc-c05158e44ad3",
            "Errors":[
               {
                  "NextAction":"c220356a-b545-493a-a68b-3f4dabfe8a2c",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            "LambdaFunctionARN":"${gpt_lambda_arn}",
            "InvocationTimeLimitSeconds":"2",
            "LambdaInvocationAttributes":{
               "isWarmUpRequest":{
                  "value":true
               }
            },
            "ResponseValidation":{
               "ResponseType":"STRING_MAP"
            }
         },
         "Identifier":"5e50ac83-e657-48b8-a46c-2d8ac2710d70",
         "Type":"InvokeLambdaFunction",
         "Transitions":{
            "NextAction":"02178d85-49c5-43d8-9b06-d048973c18e7",
            "Errors":[
               {
                  "NextAction":"02178d85-49c5-43d8-9b06-d048973c18e7",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            
         },
         "Identifier":"d7fe82c2-db96-4e78-b4d6-c305c750579c",
         "Type":"DisconnectParticipant",
         "Transitions":{
            
         }
      },
      {
         "Parameters":{
            "Text":"Hello. What would you like to ask?"
         },
         "Identifier":"Greeting message",
         "Type":"MessageParticipant",
         "Transitions":{
            "NextAction":"Lex input",
            "Errors":[
               {
                  "NextAction":"b218efd8-de8b-4cdb-939a-3c9de12b5379",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            "Text":"Error passing input to Lex, disconnecting."
         },
         "Identifier":"abf2c4cd-c921-4300-b185-63ec400fb8f5",
         "Type":"MessageParticipant",
         "Transitions":{
            "NextAction":"d7fe82c2-db96-4e78-b4d6-c305c750579c",
            "Errors":[
               {
                  "NextAction":"d7fe82c2-db96-4e78-b4d6-c305c750579c",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            "Text":"Thanks"
         },
         "Identifier":"Thanks",
         "Type":"MessageParticipant",
         "Transitions":{
            "NextAction":"Lex input",
            "Errors":[
               {
                  "NextAction":"d7fe82c2-db96-4e78-b4d6-c305c750579c",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      },
      {
         "Parameters":{
            "Text":"\"\"",
            "LexV2Bot":{
               "AliasArn":"${lex_alias_arn}"
            },
            "LexSessionAttributes":{
               "x-amz-lex:audio:max-length-ms:*:*":"15000",
               "contactId":"$.ContactId",
               "x-amz-lex:audio:end-timeout-ms:*:*":"800"
            }
         },
         "Identifier":"Lex input",
         "Type":"ConnectParticipantWithLexBot",
         "Transitions":{
            "NextAction":"abf2c4cd-c921-4300-b185-63ec400fb8f5",
            "Conditions":[
               {
                  "NextAction":"Thanks",
                  "Condition":{
                     "Operator":"Equals",
                     "Operands":[
                        "FallbackIntent"
                     ]
                  }
               },
               {
                  "NextAction":"Thanks",
                  "Condition":{
                     "Operator":"Equals",
                     "Operands":[
                        "GPTIntent"
                     ]
                  }
               }
            ],
            "Errors":[
               {
                  "NextAction":"Thanks",
                  "ErrorType":"NoMatchingCondition"
               },
               {
                  "NextAction":"abf2c4cd-c921-4300-b185-63ec400fb8f5",
                  "ErrorType":"NoMatchingError"
               }
            ]
         }
      }
   ]
}